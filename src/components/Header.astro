---
//import { isFeatureActive } from "../config/siteConfig.ts";
import { navLinks } from "../config/navLinks.ts";
import { isFeatureActive, isValidToggleKey } from "../config/siteConfig.ts";
---

<header
  class="fixed top-0 left-0 w-full bg-black/80 text-yellow-400 z-50 shadow-md"
>
  <nav class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
    <a href="/" class="text-xl font-bold hover:underline">Torghatten Maraton</a>

    <!-- Desktop -->
    <div class="hidden md:flex space-x-6">
      {
        navLinks
          .filter(
            (link) =>
              !link.toggle ||
              (isValidToggleKey(link.toggle) && isFeatureActive(link.toggle))
          )

          .map((link) =>
            "dropdown" in link ? (
              <div class="relative group">
                <button class="hover:underline whitespace-nowrap">
                  {link.label}
                </button>
                <div class="absolute left-0 min-w-[200px] bg-black/90 rounded shadow-md z-50 hidden group-hover:flex flex-col transition-all duration-200">
                  {link.dropdown.map((item) => (
                    <a
                      href={item.href}
                      target={item.external ? "_blank" : undefined}
                      rel={item.external ? "noopener noreferrer" : undefined}
                      class="block px-4 py-2 hover:bg-yellow-500 hover:text-black whitespace-nowrap"
                    >
                      {item.label}
                    </a>
                  ))}
                </div>
              </div>
            ) : (
              <a href={link.href} class="hover:underline whitespace-nowrap">
                {link.label}
              </a>
            )
          )
      }
    </div>

    <!-- Mobilknapp -->
    <button class="md:hidden" id="menu-button">
      <svg
        class="w-6 h-6 text-yellow-400"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
    </button>
  </nav>

  <!-- Mobilmeny -->
  <div
    id="mobile-menu"
    class="md:hidden hidden px-4 pb-4 space-y-2 bg-black text-center"
  >
    {
      navLinks
        .filter(
          (link) =>
            !link.toggle ||
            (isValidToggleKey(link.toggle) && isFeatureActive(link.toggle))
        )

        .map((link) =>
          "dropdown" in link ? (
            <div>
              <div class="font-semibold mt-4">{link.label}</div>
              {link.dropdown.map((item) => (
                <a
                  href={item.href}
                  target={item.external ? "_blank" : undefined}
                  rel={item.external ? "noopener noreferrer" : undefined}
                  class="block hover:underline"
                >
                  {item.label}
                </a>
              ))}
            </div>
          ) : (
            <a href={link.href} class="block hover:underline">
              {link.label}
            </a>
          )
        )
    }
  </div>

  <script>
    const btn = document.getElementById("menu-button");
    const menu = document.getElementById("mobile-menu");
    if (btn && menu) {
      btn.addEventListener("click", () => {
        menu.classList.toggle("hidden");
      });
    }
  </script>
</header>
